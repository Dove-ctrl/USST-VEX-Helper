## 电机
电机是机器人主要的执行器之一，机器人移动，搬运，攀爬等动作，几乎都需要电机参与。

***

#### 声明和定义
```c++
motor Motor;
motor Motor =  motor(PORT1 , ratio6_1 , false);
```
电机定义语句，参数从左往右代表：**端口 ， 齿比 ， 默认转向**。
- 端口：电机与主控连接的端口。
- 齿比：电机内部齿轮箱的齿比，此参数设置不影响电机功率输出，但影响电机内置编码器读数，不同齿比下电机输出转速不同。
- 默认转向：`false`代表电机默认转向与机盖上标注方向相同，`true`代表与标注方向相反。  

:warning: 齿比设置虽然不影响功率输出，但是电机内置编码器会参与控制算法，因此为了保证系统运行正确，齿也要设置正确。
:warning: 默认转向需要分析电机实际运动情况，例如底盘电机会使用齿轮串联在一起，那么不同位置的电机默认转向可能不同，**错误的转向设置可能会导致电机堵转，进而导致电机损坏** 。

***

#### spin()函数
```c++
Motor.spin(fwd , 12000 , voltageUnits::mV);
Motor.spin(fwd , 100 , pct);
Motor.spin(fwd , 200 , velocityUnits::rpm);
```
主要有3个重载函数，从上至下分别表示：用 **电压控制，用功率控制，用速度控制** 。参数从左往右代表：**转向，数值，单位** 。转向默认fwd就可以，因为定义电机时已经考虑转向的影响。

1.  最常用的是用电压控制，原因是可以绕过电机自带的PID控制算法，从而精准控制电机，而且用电压控制可以"超频"，突破电机额定转速（例如11w电机装上蓝色齿轮箱，用功率或速度控制时，实际空载输出约为600rpm，但用电压控制时，实际空载输出约为640rpm），但是电机自带最大电压限制，一般是12.7v左右，实际和其他设备分压后最终只有12v左右，如果设备数量很多，这个数值还会更小。另外，在调用这个函数时，电压的单位 **需要加`voltageUnits::`限定作用域** ，以确定函数重载。
2.  用功率控制适合调试用，用于检查电机状态检查，或者快速搭建底盘驱动程序进行测试。但是需要注意的是这里的功率控制，写法上并不是以w为单位，而是百分比，代表以百分之多少的最大功率运行。

:high_brightness: spin函数可以理解为是一个指令，它只告诉电机以何种方式旋转，而不会持续控制电机，如果你要控制电机，那么应该用一个循环去不断刷新电机的电压，也就是说，任何控制电机运动的代码，都应该有一个循环刷新电压。

***

#### position()和resetPosition()函数
```c++
Motor.position(rotationUnits::deg);
Motor.resetPosition();
```
这两个是关于电机内置编码器的函数，使用它们你可以知道电机旋转的实际参数。
- `position()`用于获取编码器的值，参数代表单位，有deg，rev两种，deg代表degree，也就是度数，rev代表reverse，也就是圈数。

- `resetPosition()`用于重置编码器的值。

***

#### spinFor()和spinTo()函数
```c++
Motor.spinFor(fwd , 720 , rotationUnits::deg , 200 , velocityUnits::rpm , false);
Motor.spinFor(fwd , 1000 , sec , 200 , velocityUnits::rpm);
Motor.spinTo(180 , rotationUnits::deg , true);
```
这两个函数可以 **持续控制** 电机转动一段时间然后自己停下来，不需要去刷新电压。这两个函数都有很多重载，不同的参数搭配会有不同效果，如果上面三个函数你看明白了的话，其实很好理解，实在不行，下载程序上机器试试就知道了，这里就不多赘述了。

- 这里解释一下 **For和To的区别** ：For代表转动到相对于起始点的某个位置，To代表转动到相对于绝对零位的某个位置，也即是说 **For代表旋转到相对位置** ， **To代表旋转到绝对位置** ，如果还是不好理解，建议实操感受一下。

- 需要特别说明的是这两个函数的最后一个bool类型参数，这个参数代表 **是否等待运动完成就执行下一行代码** ，如果填false，代表这个函数一开始执行就会立刻开始执行下一行代码，电机的运动控制"被挂在后台了"，如果填true，代表这个函数只有等电机运动结束后才会执行下一行代码，因此，可以把最后一个接受函数指令的电机设置为true，在它前面接受函数指令的电机全部设置为false，就能控制这一堆电机同时开始运动，同时结束运动。

***

#### stop()函数
```c++
Motor.stop();
Motor.stop(brake);
```
这个函数控制电机停止转动。参数代表停止类型，有 **coast，brake，hold** 三种， **不填默认为coast** 。
- `coast`表示滑行，电机停止后系统会因惯性继续运动一段时间。
- `brake`表示刹车，电机停止后会施加一个较小反向电压，克服惯性作用，系统会立即停止运动。
- `hold`表示保持，电机停止后会施加一个较大的方向快速变化的电压，克服一定范围内的外力作用，系统在停止运动后不会因外力作用改变位置。

:high_brightness: 这个函数可以和spin函数配合使用，当控制算法没有输入时，可以 **用stop函数让电机停止运动** 。

***

#### setMaxTorque()函数
```c++
Motor.setMaxTorque(2.5 , currentUnits::amp);
```
这个函数可以设置电机的最大电流。参数从左到右代表：**电流数值**，**单位**。
:high_brightness: 设置最大电流，变相等于限定了电机的最大功率，也决定了电机的加速性能。当主控连接8个以上11w电机的时候，会开始主动限流，因为主控能提供给电机的电流最大为20A，所以每个电机能分配到的最大电流，会低于标准的2.5A，而这个过程是不可控的。因此，为了能够合理分配电流，或者说是功率，可以在初始化时，让一些需要大电流工作的电机分配更多电流，例如底盘驱动电机，而一些不需要那么多电流的电机分配少一点，不影响大电流电机工作。

***
#### :door: [回到API](/programming/API/VEX_API.md)