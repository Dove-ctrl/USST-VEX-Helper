## 程序结构设计
这一部分是关于你如何编排代码的一些指导。机器人控制程序是一个工程问题，你需要思考如何构建一个:house:房子，并塞入实现各种功能的代码。

####  1.什么是程序结构设计？
- 程序结构设计是指在编写具体代码之前，对系统的各个组成部分之间的关系、职责划分、数据流动、控制流程等进行规划和定义的过程。一个良好的结构设计，就像一座建筑的坚固骨架。

#### 2.为什么程序结构设计如此重要？
- :arrow_down:**降低复杂度**：将庞大系统分解为小而独立的模块，分而治之，程序员可以只关注宏观功能上的开发，而不是纠结细枝末节的代码。
- :arrow_up:**提高可维护性**：当需求变更或出现 Bug 时，能快速定位并修改相应模块，而不影响其他部分。
- :arrow_up:**增强可扩展性**：新的功能可以很容易地以模块化的方式添加进来。
- :recycle:**促进代码复用**：设计良好的模块可以在项目内甚至跨项目被重复使用。
- :family:**改善团队协作**：清晰的模块边界使得多个开发人员可以并行工作而互不干扰。
- :arrow_up:**提高可测试性**：独立的模块可以方便地进行单元测试。

#### 3.程序结构设计的原则
- **关注点分离**：将一个程序分解成多个功能上尽可能独立的、不重叠的模块。每个模块只负责一个特定的功能或“关注点”。
- **高内聚、低耦合**：高内聚指的是，一个模块内部的各个元素（函数、类）彼此关联紧密，共同完成一个明确的目标。低耦合指的是，模块与模块之间的依赖关系尽可能的少、简单且明确。修改一个模块时，应尽量减少对其他模块的影响。

***

### 系统架构
从上面的介绍不难看出，我们需要的程序设计，大致上跟拼积木一样，需要把各种不同功能的积木拼在一起，这一部分就是在介绍有哪些不同的积木。编者介绍的是自己常用的架构，只要你也满足以上的原则和要求，你也可以自己设计。

#### 为什么这样设计？
1. VEX竞赛机器人大体上分成两个部分，不论赛季如何变化，这两个部分总是存在，且关系基本不会改变。第一个部分是**底盘**（chassis），它主要完成机器人在场上的移动，第二个部分是**互动机构**（structure），它主要完成机器人和场地元素的互动，例如拾取得分物，移动得分物到指定位置等。
2. 机器人完成某个动作，总是遵循：**收到指令，计算输出，执行动作**的过程，那么这个架构只需要干好这三件事情就可以了。
3. 机器人系统或其子系统基本包含以下三个部件：**传感器，控制器，执行器**，它们对应上面三件事。
4. 数据会在三个部件之间传输，所以需要使用**驱动**（drive），作为三个部件之间沟通的桥梁。

#### 底盘-chassis
底盘是隶属于机器人系统的一个子系统，它的内部也包含传感器，控制器，执行器，它只负责机器人的移动，可以完全独立运行。
##### 1. 里程计
里程计是传感器，它负责完成机器人的全局定位，测量全局坐标和偏航角。它本质上也是一个子系统，因为它包含编码器，IMU两个传感器。里程计包含一个驱动，会实时刷新位姿参数，以供使用。
##### 2. PID
PID是经典控制算法，它负责完成机器人移动参数的计算。这里的PID控制器其实并没有实体，它只是一个算法，存在于虚拟的代码内部。它收集输入数据，计算输出，电机会根据输出转动。
##### 3. 电机
底盘包含很多电机，为了降低开发难度，我们应该把这些电机看作一个电机组，我们只需要关心底盘移动多少，而不需要具体到每个电机转动多少，这些交给程序计算即可。电机组也包含一个驱动，实时刷新电机的电压，保证运动控制的实时性。

#### 互动机构-structure
互动机构也是隶属于机器人的一个子系统，然而，互动机构可能不止一种，例如抬升机构和拾物机构必然在运动逻辑上有差别，前者需要机构抬升或下降到指定角度，而后者可能只需要旋转即可。互动机构也不一定完全包含三个部件。下面的机构不包含所有机构，只是例子和提供参考，本质都是一样的。

##### 1. 拾物机构
一般是几个电机组成，也只需要旋转，可以简单作为一个电机组处理。
##### 2. 抬升机构
抬升机构可能包含传感器，因为可能需要机构抬升到指定角度，那么这个时候可以把抬升机构看作一个“底盘”，其基本运行逻辑和底盘类似。
##### 3. 气动连杆
这里就需要控制气动活塞运动，这个子系统只包含两个状态，开和关，所以它甚至只有一个执行器。

***
#### :door: [回到编程](/programming/programming.md)