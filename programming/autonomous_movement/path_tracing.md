## 路径跟踪
轮式机器人的路径跟踪，是指机器人在已经规划好的参考路径基础上，通过实时控制其运动状态（如速度、角速度、姿态等），使其尽可能准确地沿着期望路径行驶的技术。它是机器人自主移动中的关键环节，直接影响机器人运行的稳定性、安全性和精度。

***

### 基本原理
路径跟踪控制的核心目标是减小机器人当前位姿与参考路径之间的偏差，包括：
- 横向误差：机器人中心到最近路径点的垂直距离；
- 航向误差：机器人当前朝向与路径切线方向之间的角度差；
- 纵向误差（可选）：沿路径方向的速度或位置偏差。

控制器根据这些误差，实时调整机器人的线速度和角速度，使其逐步收敛到参考路径上。

***

### 纯追踪法（Pure Pursuit）
Pure Pursuit 是一种应用广泛的轮式移动机器人路径跟踪算法，因其结构简单、计算量小、易于实现，在自动驾驶、服务机器人、AGV 等领域被广泛采用。路径跟踪控制方法有很多种，这里我们就选择这种实现简单，效果也不错的方法，并以两轮差速模型为例，进行数学推导。

#### 核心思想
Pure Pursuit 的核心思想是**模拟人类驾驶行为**：驾驶员不会只盯着车前，而是看前方某个“目标点”并调整方向驶向该点。算法通过在当前路径上选取一个前瞻点（Look-ahead Point），并控制机器人沿圆弧轨迹驶向该点，从而实现路径跟踪。你可以简单理解为：机器人是一只猪，而Pure Pursuit算法是一个拿着胡萝卜钓竿的史蒂夫，并骑在猪上。机器人会一直追随这个“胡萝卜”，但永远“吃不到”，而Pure Pursuit算法会根据机器人当前位置和预定路径的差距，调整胡萝卜钓竿的位置，从而控制机器人运动。

#### 影响跟踪性能的参数
1. 前瞻距离（Look-ahead Distance）
当前瞻距离过大，意味着胡萝卜钓竿很长，当机器人遇到急转弯时，由于过长的钓竿可能会直接“越过”这个弯道，机器人的运动就会忽略这个转弯，影响跟踪效果。当前瞻距离过小，意味着胡萝卜钓竿很短，当机器人遇到一段很长的弧线时，有可能因为算法过于在意近距离的点，导致胡萝卜钓竿频繁调整方向，使得机器人产生震动，影响跟踪效果。因此前瞻距离的设置极为重要。

2. 基础速度（Base Speed）
在机器人遇到急转弯时，需要减速通过，否则可能会因为惯性导致漂移，瞬间产生巨大的位置误差。遇到曲率小的长弧线时，为了节省时间，可以加速通过。

#### 控制律推导
我们从圆弧几何出发，设：

ld：前瞻距离（Look-ahead Distance）
α：机器人当前航向与目标点方向之间的夹角（航向误差角）

目标：让机器人沿圆弧轨迹驶向目标点，求所需角速度 ω

<p>根据圆弧几何关系，机器人轨迹的瞬时曲率：</p>
<div class="formula">κ = 2 sinα / l<sub>d</sub></div>
<p>差速模型的角速度与曲率关系：</p>
<div class="formula">ω = κ · v = 2v sinα / l<sub>d</sub></div>

#### 控制流程
<ol>
    <li><strong>路径预处理</strong>：将全局路径转换到机器人坐标系。</li>
    <li><strong>前瞻点选择</strong>：沿路径向前搜索距离大于等于 l<sub>d</sub> 的第一个点 (x<sub>g</sub>, y<sub>g</sub>)。</li>
    <li><strong>计算航向误差角 α</strong>：
        <pre><code>α = atan2(y_g, x_g)</code></pre>
    </li>
    <li><strong>计算角速度命令</strong>：
        <pre><code>ω = 2v sinα / l<sub>d</sub></code></pre>
    </li>
    <li><strong>计算左右轮速</strong>：
        <pre><code>v<sub>r</sub> = v + (b / 2) ω<br>v<sub>l</sub> = v − (b / 2) ω</code></pre>
    </li>
    <li><strong>下发速度命令</strong>给电机驱动器。</li>
</ol>

***
#### :door: [回到轮式机器人自主移动](/programming/autonomous_movement/autonomous_movement.md)