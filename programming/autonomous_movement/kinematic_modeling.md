## 运动学模型
轮式机器人运动学模型，就是“把车轮转速换算成整车怎么动”的一套几何公式，不考虑力与质量，只关心轮子和机器人的关系。实际上，这样做的原因是为了简化编程的过程，或是人类程序员思考的过程。有了运动学模型，你只需要考虑机器人往哪里走，走多少，而并不需要思考每个轮子该怎么转，这在设计复杂底盘时帮助很大。
这里给出两种常见的运动学模型：两轮差速和四Omni轮全向移动。

![standard_drive](/attachment/picture/standard_drive.jpeg)

![x_drive](/attachment/picture/x-drive.webp)

***

### 两轮差速模型
#### 模型假设
- 两个驱动轮左右对称，轮距 L 
- 轮与地面纯滚动、无侧滑
- 忽略结构形变
- 只在二维平面运动，状态向量 ξ = [x, y, θ]ᵀ，(x,y) 为轮轴中心坐标，θ 为车头朝向角

#### 正运动学
给定：
vL = 左轮线速度（m/s）
vR = 右轮线速度（m/s）

瞬时线速度 v 与角速度 ω ：
v  = (vR + vL)/2        —— 沿车体纵轴方向
ω = (vL - vR)/L        —— 绕车体中心顺时针为正

#### 逆运动学
把上面两式反解：
vL = v − ω·L/2
vR = v + ω·L/2

:high_brightness:控制器每周期给定 (v, ω)，就可以用这对公式算左右电机目标转速，下发给 PID。

#### 侧滑约束
车体横向速度必须为零。但实际上，如果你使用的轮子是Omni轮，也就是上面第一张图片那个样子，显然是会发生侧向移动的，那么该模型就只在机器人进行不会发生侧滑的运动下生效，一旦机器人发生侧滑，就无法再用该模型描述。

***

### 四Omni轮全向移动模型
#### 模型假设
- 平面运动，无滑动
- 四个轮心对称放在半径为 R 的圆上，角度间隔 90°，辊子与地面接触点位于同一圆周上
- 车体坐标系定义：y-前，x-右，顺时针 ω 为正（右手系）
- 参数定义：
v_x, v_y  —— 车体中心沿 x、y 的线速度（m/s）
ω         —— 车体角速度（rad/s，逆时针）
φ_i       —— 第 i 轮转速（rad/s，正转=车轮外缘向车体前方）
r         —— 车轮外圆半径（m）
- 轮子编号定义：

    | 轮编号    | α\_i (从 +y 顺时针) |
    | ------ | --------------- |
    | 0 (FL) | 45°             |
    | 1 (FR) | −45°            |
    | 2 (RL) | 135°            |
    | 3 (RR) | −135°           |

#### 正运动学
第 i 轮与地面接触点的切向速度（沿车轮前进方向）必须等于：
v_i = r φ_i

而该车体运动在轮心处产生的切向速度为：
v_i = v_x cosα_i + v_y sinα_i + ω R

于是：
r φ_i = v_x cosα_i + v_y sinα_i + ω R ----------(1)

把 (1) 写成 4×3 线性系统：
A · [v_x, v_y, ω]^T = r φ

其中 A 的每一行为：
A_i = [cosα_i, sinα_i, R]

代入角度（cos45° = sin45° = √2/2）：
A = ⎡  cos45°  sin45°  R ⎤ 
⎢ cos(−45°) sin(−45°) R ⎥ 
⎢ cos135° sin135°  R ⎥   
⎣ cos(−135°) sin(−135°) R ⎦   

可得：
A =⎡  √2/2   √2/2   R ⎤
⎢  √2/2  −√2/2   R ⎥
⎢ −√2/2   √2/2   R ⎥
⎣ −√2/2  −√2/2   R ⎦

与之前完全相同，AᵀA 仍为对角阵：
AᵀA = diag(2, 2, 4R²)

于是：
[v_x, v_y, ω]^T = (AᵀA)^{−1} Aᵀ · r φ = A⁺ · r φ

显式解析解：
v_x = (r √2 / 4) (φ0 + φ1 − φ2 − φ3)        (2a)
v_y = (r √2 / 4) (φ0 − φ1 + φ2 − φ3)        (2b)
ω   = (r / 4R)   (φ0 + φ1 + φ2 + φ3)        (2c)

验证一下方向：
令 φ0 = φ1 = φ2 = φ3 = φ > 0：
v_x = 0, v_y = 0, ω = r φ / R > 0 → 顺时针自转，符合。

令 φ0 = φ2 = +φ, φ1 = φ3 = −φ：
v_x = 0, v_y = r √2 φ / 2 > 0, ω = 0 → 纯向前，符合。

#### 逆运动学
由式 (1) 直接反解：
φ_i = (1/r) [v_x cosα_i + v_y sinα_i + ω R] ----------(2)

把四个 α_i 代入（cos45° = sin45° = √2/2）：
φ_0 = (1/r) [ v_x·√2/2 + v_y·√2/2 + ωR ]        (3a)
φ_1 = (1/r) [ v_x·√2/2 − v_y·√2/2 + ωR ]        (3b)
φ_2 = (1/r) [−v_x·√2/2 + v_y·√2/2 + ωR ]        (3c)
φ_3 = (1/r) [−v_x·√2/2 − v_y·√2/2 + ωR ]        (3d)

解析式：
φ_0 = (1/r) [ (√2/2)(v_x + v_y) + ωR ]        (4a)
φ_1 = (1/r) [ (√2/2)(v_x − v_y) + ωR ]        (4b)
φ_2 = (1/r) [ (√2/2)(−v_x + v_y) + ωR ]       (4c)
φ_3 = (1/r) [ (√2/2)(−v_x − v_y) + ωR ]       (4d)

验证一下方向：
纯向右：v_x > 0, v_y = 0, ω = 0
φ_0 = φ_1 = +, φ_2 = φ_3 = −，对称加速，符合。

纯向前：v_y > 0, v_x = 0, ω = 0
φ_0 = φ_2 = +, φ_1 = φ_3 = −，前后轮反向，符合。

纯顺时针自转：ω > 0, v_x = v_y = 0
四轮同号且相等，符合。

***
#### :door: [回到轮式机器人自主移动](/programming/autonomous_movement/autonomous_movement.md)